<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>plyrplayer</title>
	<link rel="icon" type="image/png" href="180x180.png" />
	<style>
		html, body {
			margin: 0;
			padding: 0;
			font-family: sans-serif;
			background-color: #0f0f0f;
			color: #fff;
			height: 100%;
		}

		#app {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			height: 100%;
		}

		#player-container {
		  width: 900px;
		  min-width: 20%;
		  max-width: 70%;
		  display: none;
		  resize: horizontal;
		  overflow: auto;
		}

		#video-wrapper {
			aspect-ratio: 16 / 9;
			background: black;
		}

		#drop-zone {
			border: 2px dashed #333;
			padding: 30px;
			text-align: center;
			background-color: #1a1a1a;
			color: #ccc;
			border-radius: 8px;
			max-width: 400px;
			cursor: pointer;
		}

		#drop-zone.hover {
			border-color: #888;
			background-color: #222;
		}

		#file-button {
			position: fixed;
			bottom: 20px;
			right: 20px;
			background-color: #272727;
			color: #eee;
			border: 1px solid #444;
			padding: 10px 16px;
			border-radius: 4px;
			cursor: pointer;
			display: none;
		}

		input[type="file"] {
			display: none;
		}

		video {
			width: 100%;
			height: 100%;
		}

		#video-info {
			margin-top: 12px;
			width: 100%;
			max-width: 960px;
			color: #ccc;
			font-size: 14px;
		}

		#video-info strong {
			color: #fff;
		}
	</style>
</head>
<body>
	<div id="app">
		<div id="drop-zone">
			<p>Drag and drop a video or select a file</p>
			<input type="file" id="fileInput" accept="video/*" />
		</div>

		<div id="player-container">
			<div id="video-wrapper">
				<video id="player" playsinline controls></video>
			</div>
		</div>
	</div>

	<button id="file-button">Choose another file</button>
    <link rel="stylesheet" href="plyr/plyr.css" />
	<script src="plyr/plyr.js"></script>
	<script src="plyr/playerconfig.js"></script>
<script>
	const dropZone = document.getElementById('drop-zone')
	const fileInput = document.getElementById('fileInput')
	const playerElement = document.getElementById('player')
	const playerContainer = document.getElementById('player-container')
	const fileButton = document.getElementById('file-button')
	const videoInfo = document.getElementById('video-info')
	const videoTitle = document.getElementById('video-title')
	const videoType = document.getElementById('video-type')
	const videoSize = document.getElementById('video-size')
	const savedWidth = localStorage.getItem('playerContainerWidth');
	if (savedWidth) {
		playerContainer.style.width = savedWidth + 'px';
	}

	let resizeTimeout;

	const observer = new MutationObserver(mutations => {
		for (const mutation of mutations) {
			if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
				clearTimeout(resizeTimeout);
				resizeTimeout = setTimeout(() => {
					const width = playerContainer.offsetWidth;
					console.log(`[Resize] width changed to: ${width}px`);
					localStorage.setItem('playerContainerWidth', width);
				}, 200);
			}
		}
	});

	observer.observe(playerContainer, { attributes: true, attributeFilter: ['style'] });

	function formatFileSize(bytes) {
		if (bytes < 1024) return bytes + ' B'
		if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB'
		if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB'
		return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB'
	}

	function formatBitrate(bps) {
		if (bps >= 1_000_000) {
			return bps / 1_000_000 % 1 === 0
				? (bps / 1_000_000).toFixed(0) + ' Mbps'
				: (bps / 1_000_000).toFixed(2) + ' Mbps'
		}
		if (bps >= 1_000) {
			return bps / 1_000 % 1 === 0
				? (bps / 1_000).toFixed(0) + ' kbps'
				: (bps / 1_000).toFixed(2) + ' kbps'
		}
		return bps.toFixed(0) + ' bps'
	}

	function handleFile(file) {
		const url = URL.createObjectURL(file)
		playerElement.src = url
		playerContainer.style.display = 'block'
		dropZone.style.display = 'none'
		fileButton.style.display = 'block'
		player.play()

		let infoBlock = document.getElementById('video-info')
		if (!infoBlock) {
			infoBlock = document.createElement('div')
			infoBlock.id = 'video-info'
			infoBlock.style.display = 'none'
			document.getElementById('player-container').appendChild(infoBlock)

			const keys = ['title', 'resolution', 'size', 'bitrate', 'type']
			for (const key of keys) {
				infoBlock.innerHTML += `<p><strong>${key[0].toUpperCase() + key.slice(1)}:</strong> <span id="video-${key}"></span></p>`
			}
		}

		playerElement.onloadedmetadata = () => {
			const { duration, videoWidth: w, videoHeight: h } = playerElement

			const fields = {
				title: file.name,
				type: file.type || 'unknown',
				size: formatFileSize(file.size),
				bitrate: duration && duration !== Infinity ? formatBitrate((file.size * 8) / duration) : 'Unknown',
				resolution: `${w}Ã—${h}`
			}

			for (const key in fields) {
				const span = document.getElementById('video-' + key)
				if (span) span.textContent = fields[key]
			}

			infoBlock.style.display = 'block'
		}
	}

	fileInput.addEventListener('change', e => {
		if (e.target.files[0]) handleFile(e.target.files[0])
	})

	;[dropZone, fileButton].forEach(el => el.addEventListener('click', () => fileInput.click()))

	dropZone.addEventListener('dragover', e => {
		e.preventDefault()
		dropZone.classList.add('hover')
	})

	dropZone.addEventListener('dragleave', () => {
		dropZone.classList.remove('hover')
	})

	dropZone.addEventListener('drop', e => {
		e.preventDefault()
		dropZone.classList.remove('hover')
		if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0])
	})

	window.addEventListener('dragover', e => e.preventDefault())

	window.addEventListener('drop', e => {
		e.preventDefault()
		for (const file of e.dataTransfer.files) {
			if (file.type.startsWith('video/')) {
				handleFile(file)
				break
			}
		}
	})

	window.addEventListener('keydown', e => {
	  const tag = document.activeElement.tagName.toLowerCase();
	  const isEditable = document.activeElement.isContentEditable;

	  if (tag === 'input' || tag === 'textarea' || isEditable) return;

	  switch (e.code) {
		case 'Space':
		  e.preventDefault();
		  if (player.paused) player.play();
		  else player.pause();
		  break;
		case 'ArrowRight':
		  e.preventDefault();
		  player.currentTime = Math.min(player.currentTime + 5, player.duration);
		  break;
		case 'ArrowLeft':
		  e.preventDefault();
		  player.currentTime = Math.max(player.currentTime - 5, 0);
		  break;
		case 'ArrowUp':
		  e.preventDefault();
		  player.volume = Math.min(player.volume + 0.05, 1);
		  break;
		case 'ArrowDown':
		  e.preventDefault();
		  player.volume = Math.max(player.volume - 0.05, 0);
		  break;
		case 'KeyF':
		  e.preventDefault();
		  if (document.fullscreenElement) document.exitFullscreen();
		  else playerElement.requestFullscreen();
		  break;
	  }
	});


</script>

</body>
</html>
